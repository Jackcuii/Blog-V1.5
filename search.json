[{"title":"Preface of My New Blog","url":"/2025/10/12/hello-world/","content":"New TitleThe title Leeward is a navigational term, which means towards the same direction as the wind. There is a interesting story behind it.\nWhen I first wanted to look up this word, I want to find a word means â€˜faces the direction the wind goesâ€™. And for some reasons, Gemini (no offense to Gemini, I love it!) told me it is leeward (but actually the true word is windward, Leeward and Windward).\nAfter I experienced several events&#x2F;decisions, I found this word is quite suitable. Though we always want to and can do something interesting and different, we should also follow the general trend of the world, in all kinds of aspects.\nBTW, Leeward is also ok to be a name of a person, since Lee and Ward are both legendsâ€™ names. ðŸ˜‚ I plan to deploy it as my new English name, after I develop some Cocktail Party Effect on it.\n(Partially) New Start of Transient Personal WebsiteI planned to make a new self-designed website since this summer, using Astro. But it is too time-consuming to complete one (need visual design, SVG drawing and implementionâ€¦ especially given I am not familiar with frontend dev) and I think I will take half a year to finish it. The website is (maybe) an urgent need for application season, and the Redefine theme is really good (Thanks for talented developer Evan Luo). So I decide to use the new-version Redefine again to refactor my old blog and migrate some of old blogs to this new one.\nHope you can find something interesting here!\nSorry that some of my old blogs are written in Chinese, which is not friendly for international readers. I will try to post more techinical contents and interesting bilingual things onto it. \nTo see full (not really full, though) old content of my old blogs, please go to V1.0\n","categories":["Misc"],"tags":["Chatter"]},{"title":"5GC Telco System Intro","url":"/2025/10/13/telco/","content":"\nStill under construction\n\n3GPP 5G Core ArchTwo Open-source implementations: OpenAir(EU), free5gcFeatures - free5GC\n\nThe squares on the diagram are NF (network function). They are individual function modules of the 5G network. The NFs shown on the diagram above is a subset of 3GPP Spec\nWhole NF list is at: TS 123.501 $4.2.2 Network Functions and entities\n\n\nThe links on the figure above is Reference Point. It is an abstract concept. It means the logical interaction between two NFs. It specifies what information will be exchanged between the two ends, what function do their behaviors want to achieve and what protocol they will use. RP is different from Protocol, since  RP is about what and why, while protocol is about how. So you can approximately analogize it to API. It is commonly implemented by HTTP&#x2F;2. \nNotice:  There is not a corresponding physical impl of RFs, it is a logical conception.  \n\n\nSignaling is the control message exchanged  by the 5GC.\nNetwork Slicing means implementing several logical separated end-to-end network instance with different QoS guarantee in a shared network infrastructure.\n\nAMF (Access and Mobility Management function)\nTS 123.501 $6.2.1\n\nAMF controls the UEsâ€™ network access and handle the location change of the UE.\nAUSF (Authentication Server Function)AUSF is used to authenticate the access of the UE.\nUDM (Unified Data Management)UDM serves as a memory controller to the UDR\nUDR (Unified Data Management)UDR is the abstract interface of the database to store user data.\nNSSF (Network Slice Selection Function)NSSF is used to manage and select the QoS (S-NSSAIs).\nSMF (Session Management Function)SMF is used to manage the PDU sessions of the nework.Each SMF can manage a certain amount of sessions.  A SMF may support a set of DNN  and S-NSSAI combinationã€‚And can be dynamically scale up&#x2F;down.When a new SMF  instance is deployed, it is registered to the NRF.The arch is designed with the C-U separation philosophy.When the channel is established, the AMF handle the control to SMF, its design is actually like the Control plane of the control plane.\nNRF (Network Repository Function)NRF is the base of SBA. It is like a DNS server in 5G network. It enable the scalability of the network functions. NFs use the NRF to indirectly discover each other. When new NF instance is created, it is registered onto NRF.\n\nAMF-ASUF-UDM is not through NRF, the communication between them are pre-defined and static. for performance concern and their roles seldom change. (TBD)\n\nSignificant ProceduresInitial Access and RegistrationThis means the UE wants to connect to the 5g core network and get a permission from the core network to use the service.Itâ€™s is a challenge&#x2F;response procedure (AKA agreement).\nPDU Setup\n\nAMF can also be in the Edge Data Center.\n\nMobility ManagementPlease refer to session Mobility Management &amp; Area Architecture (partly inherited from 4G(LTE)).\nMobility Management &amp; Area Architecture (partly inherited from 4G(LTE))ArchitectureTS 123.501 $5.3.2.3As the former generation of the cellular network, 5G also has Cell, which means a region that a device of gNB covers. Several Cell constitute a TA(Tracking Area).When an AMF  is registered to the NRF, it will claim a set of TAs that it will manage and the slice. (TS 29.510) There are always several AMFs serving as a ReplicaSet(handle the same TA Set+Slice) and there are several AMF Sets  covering different TASet+Slice.\n\nHowever, the AMF instances are still registered NRF by instance but not by set. That is because the load-balance among the AMFs is not transparent. (TBD: What about that in Kubernetes?)\n\nWhen a UE is connected to 5gc, it will assigned a TA list by the AMF, which is called RA(Registration Area) (according to its moving pattern, service levelâ€¦). Note that RA is dynamic and UE-specific, but not a static division.\nManagement ProcedureWhen a UE moves to its neighbor cell within the TA in the RA\nif UE is CM-IDLE  (no active PDU, and), then cause Cell-Reselection. The UE connects to the new gNB.\nif UE is CM-CONNECTED, then cause Xn Handover. The network tries to hand the old gNBâ€™s work to a new gNB, with data in flight. \nBrief Procedure: The gNB contact the neighbor gNB with Xn-C (C means Control-Plane) to inform it the config info to reserve resource. Then gNB use Xn-U (U means User-Plane) to transmit the leftover data to the new gNB.\nXn is the interface between the gNBs Xn allow the gNBs managed by the same AMF  to exchange data and  config, without bothering the AMF. (TS 138.420)\n\n\n\n\nCM-IDLE means UE - AMF do not have N1 channel, but context is still in SMF. The AMF do not know the exact position of the UE, but know if it is still alive, it must be with in the TA list.CM-CONNECTED means UE - AMF have N1 channel, which means there must be a gNB in between. Thus the AMF know the precise location (in which cell) of the UE. \n\n\nA problem: why TA?When the UE move between the TAs both in the TA list, it does not need to report the position (and thus ), then the problem is AMF actually do not have TA-level position, why is TA needed.I do not find the explanation. One possible explanation is that TA list instead of Cell list can reduce the memory overhead of AMF.\n\nWhen a UE move into a cell within a TA out of the RAUE try to do Cell-reselection when it keeps hearing from the nearby gNB and decide to connect to a new cell. Then if it finds the the TA ID is not in its TA list, it knows it is going to  move into a cell within a TA out of the RA.\nif UE is in CM-IDLE\nif the new cellâ€™s TA is also in the old AMFâ€™s TA Set:\nif the old AMF can not handle the network slice:   triggers AMF Re-allocation (TS 123.502), go to 2.\nelse:   The AMF assigns a new TA list as the RA for the UE.\n\n\nif the new cellâ€™s TA is not in the old AMFâ€™s TA Set: triggers AMF Re-allocation, UE establish link with new gNB. The new gNB find a proper AMF which can support the service. The new AMF will find the UE used to be managed by another AMF. The new AMF will request the context from the old AMF, try to do authentication and inform  SMF to update the AMF information.\n\nNote: Re-allocation is not necessarily trigger by moving into a TA. It can also be triggered when UE wants to connect from IDLE state + gNB decide to change AMF due to load balance or AMF is exhausted and actively ask for re-allocation.\nif UE is in CM-CONNECTED\nif the new cellâ€™s TA is also in the old AMFâ€™s TA Set:\nif the old AMF can not handle the network slice:go to 2.\nelse: trigger Xn Handover and  assign new TA list to UE\n\n\nif the new cellâ€™s TA is not in the old AMFâ€™s TA Set: Trigger N2 Handover: The old gNB tell the new gNB to the old AMF, old AMF choose a new AMF according to the new gNB and tell the new AMF create a context. Then new AMF tell the new gNB to reserve resource and tell the SMF that it will take over. New gNB tell the new AMF it is ready, new AMF tell the old AMF it is ready, old AMF tell the old gNB it is ready. Old gNB forwards leftover to new gNB, UE establish connection with new gNB. Then UE contact the new AMF through new path, new AMF tell the old AMF to release (and later old AMF will tell old gNB to release) and tell the UE new TA list.  (really complicatedâ€¦) The key path in this handover is the Transparent Container, it supports the information exchange between the new gNB and old gNB through new gNB - new AMF - old AMF - old gNB\n\n","categories":["Telco"],"tags":["techBlogs"]}]